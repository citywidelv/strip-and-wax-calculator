<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Wide Strip & Wax Floor Pricing Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .section h2 {
            color: #374151;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #DC2626;
            padding-bottom: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #1E3A8A;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        
        .input-group small {
            display: block;
            margin-top: 5px;
            font-size: 12px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        .ic-breakdown {
            background: #F3F4F6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #1E3A8A;
        }
        
        .ic-breakdown h4 {
            color: #1E3A8A;
            margin-bottom: 10px;
        }
        
        .ic-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .ic-row input {
            width: 80px;
            text-align: right;
        }
        
        .btn {
            background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.3);
        }
        
        .results-section {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 30px;
            margin-top: 20px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #374151;
        }
        
        .result-card h3 {
            color: #374151;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .result-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #374151;
        }
        
        .result-card.highlight {
            border-left-color: #DC2626;
        }
        
        .result-card.highlight .value {
            color: #DC2626;
        }
        
        .production-rates {
            grid-column: 1 / -1;
            margin-top: 30px;
        }
        
        .rates-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .rates-table th {
            background: #374151;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .rates-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .rates-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .rates-table tr:hover {
            background: #e3f2fd;
        }
        
        .breakdown-section {
            grid-column: 1 / -1;
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid #dee2e6;
        }
        
        .material-calc {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .material-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid #28a745;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Strip & Wax Floor Pricing Calculator</h1>
            <p>Professional Time & Material Calculations Based on Industry Standards</p>
        </div>
        
        <div class="main-content">
            <!-- Project Details Section -->
            <div class="section">
                <h2>Project Details</h2>
                <div class="input-group">
                    <label for="serviceType">Service Type</label>
                    <select id="serviceType" onchange="updateServiceType()">
                        <option value="strip_refinish">Full Strip & Refinish</option>
                        <option value="scrub_topcoat">Scrub & Top Coat</option>
                    </select>
                    <small style="color: #666;" id="serviceDescription">Complete removal of old finish + 4 new coats</small>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="addBurnishing" onchange="calculatePricing()">
                    <label for="addBurnishing">Add Burnishing Service (High-Gloss Finish)</label>
                </div>
                
                <div class="input-group">
                    <label for="squareFootage">Total Square Footage</label>
                    <input type="number" id="squareFootage" placeholder="Enter square footage" value="5000" onchange="calculatePricing()">
                </div>
                
                <div class="input-group">
                    <label for="floorType">Floor Type</label>
                    <select id="floorType" onchange="calculatePricing()">
                        <option value="vct">VCT Tile (Standard)</option>
                        <option value="linoleum">Linoleum</option>
                        <option value="luxury_vinyl">Luxury Vinyl Tile (LVT)</option>
                        <option value="composition">Composition Tile</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="condition">Current Floor Condition</label>
                    <select id="condition" onchange="calculatePricing()">
                        <option value="good">Good - Recent maintenance</option>
                        <option value="fair">Fair - Normal wear</option>
                        <option value="poor">Poor - Heavy buildup</option>
                        <option value="very_poor">Very Poor - Multiple layers</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="density">Furniture Density & Moving</label>
                    <select id="density" onchange="calculatePricing()">
                        <option value="none">No Furniture - Open areas</option>
                        <option value="minimal">Minimal - Light furniture, easy to move</option>
                        <option value="light">Light - Some desks/chairs to move</option>
                        <option value="medium">Medium - Moderate furniture density</option>
                        <option value="heavy">Heavy - Dense furniture, complex moving</option>
                        <option value="very_heavy">Very Heavy - Extensive furniture/equipment</option>
                    </select>
                </div>
                
                <div class="input-group" id="coatsGroup">
                    <label for="coats">Number of Finish Coats</label>
                    <select id="coats" onchange="calculatePricing()">
                        <option value="4">4 Coats (Standard)</option>
                        <option value="5">5 Coats (High Traffic)</option>
                        <option value="6">6 Coats (Premium/High Sheen)</option>
                        <option value="3">3 Coats (Light Traffic)</option>
                    </select>
                </div>
            </div>
            
            <!-- Vendor Labor & Equipment Section -->
            <div class="section">
                <h2>Vendor Labor & Equipment</h2>
                
                <!-- IC Rate Breakdown -->
                <div class="ic-breakdown">
                    <h4>Independent Contractor Rate Breakdown</h4>
                    <div class="ic-row">
                        <label>Raw Labor Rate:</label>
                        <span>$</span>
                        <input type="number" id="rawLaborRate" step="0.01" value="18.00" onchange="updateICBreakdown()">
                    </div>
                    <div class="ic-row">
                        <label>FICA (7.65%):</label>
                        <span id="ficaAmount">$1.38</span>
                    </div>
                    <div class="ic-row">
                        <label>FUTA (0.60%):</label>
                        <span id="futaAmount">$0.11</span>
                    </div>
                    <div class="ic-row">
                        <label>Work Comp (2.50%):</label>
                        <span id="workCompAmount">$0.45</span>
                    </div>
                    <div class="ic-row">
                        <label>GL (0.50%):</label>
                        <span id="glAmount">$0.09</span>
                    </div>
                    <div class="ic-row">
                        <label>State Income Tax (%):</label>
                        <input type="number" id="stateTax" step="0.01" value="0.00" onchange="updateICBreakdown()">
                        <span id="stateTaxAmount">$0.00</span>
                    </div>
                    <div class="ic-row" style="border-top: 1px solid #ddd; padding-top: 8px; margin-top: 8px;">
                        <label><strong>Sub Total:</strong></label>
                        <span id="subTotal"><strong>$20.03</strong></span>
                    </div>
                    <div class="ic-row">
                        <label>IC Profit & OH (%):</label>
                        <input type="number" id="icProfitRate" step="0.1" value="10.0" onchange="updateICBreakdown()">
                        <span id="icProfitAmount">$2.00</span>
                    </div>
                    <div class="ic-row" style="border-top: 2px solid #1E3A8A; padding-top: 8px; margin-top: 8px;">
                        <label><strong>IC Loaded Rate:</strong></label>
                        <span id="icLoadedRate"><strong>$22.03</strong></span>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="stripperCasePrice">SC Johnson Stripper Price ($/case)</label>
                    <input type="number" id="stripperCasePrice" step="1.00" value="90.00" onchange="calculatePricing()">
                    <small style="color: #666;">2-gallon concentrate case, makes up to 50 gallons diluted</small>
                </div>
                
                <div class="input-group">
                    <label for="finishCasePrice">SC Johnson Finish Price ($/case)</label>
                    <input type="number" id="finishCasePrice" step="1.00" value="140.00" onchange="calculatePricing()">
                    <small style="color: #666;">5-gallon case, ready-to-use finish</small>
                </div>
                
                <div class="input-group">
                    <label for="crewSize">Crew Size</label>
                    <select id="crewSize" onchange="calculatePricing()">
                        <option value="1">1 Person</option>
                        <option value="2" selected>2 People (Recommended)</option>
                        <option value="3">3 People (Large Areas)</option>
                        <option value="4">4 People (Very Large Areas)</option>
                        <option value="5">5 People (Massive Projects)</option>
                        <option value="6">6 People (Stadium/Arena Size)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="equipmentRate">Equipment Rate ($/hour)</label>
                    <input type="number" id="equipmentRate" step="0.50" value="8.00" onchange="calculatePricing()">
                    <small style="color: #666;">Covers transport, setup, depreciation & maintenance</small>
                </div>
                
                <div class="input-group">
                    <label for="cwMargin">City Wide Margin (%)</label>
                    <input type="number" id="cwMargin" step="1" value="35" min="0" max="50" onchange="calculatePricing()">
                    <small style="color: #666;">Applied to both labor and materials (divide cost by 0.65)</small>
                </div>
                
                <div class="input-group">
                    <label for="timeOfService">Time of Service</label>
                    <select id="timeOfService" onchange="calculatePricing()">
                        <option value="normal">Normal Hours</option>
                        <option value="third_shift">Third Shift (Midnight-6am) (+25%)</option>
                    </select>
                </div>
                
                <button class="btn" onclick="calculatePricing()">Calculate Strip & Wax Pricing</button>
            </div>
        </div>
        
        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <h2>Pricing Results</h2>
            <div class="results-grid">
                <div class="result-card">
                    <h3>Total Labor Hours</h3>
                    <div class="value" id="totalHours">0</div>
                </div>
                <div class="result-card">
                    <h3>Vendor Labor Cost</h3>
                    <div class="value" id="vendorLaborCost">$0</div>
                </div>
                <div class="result-card">
                    <h3>Equipment Cost</h3>
                    <div class="value" id="equipmentCost">$0</div>
                </div>
                <div class="result-card">
                    <h3>Material Cost (w/ Margin)</h3>
                    <div class="value" id="materialCost">$0</div>
                </div>
                <div class="result-card">
                    <h3>Total Cost to CW</h3>
                    <div class="value" id="totalCost">$0</div>
                </div>
                <div class="result-card">
                    <h3>Price Per Sq Ft</h3>
                    <div class="value" id="pricePerSqFt">$0.00</div>
                </div>
                <div class="result-card highlight">
                    <h3>Final Client Price</h3>
                    <div class="value" id="bidPrice">$0</div>
                </div>
                <div class="result-card highlight">
                    <h3>CW Gross Profit</h3>
                    <div class="value" id="cwProfit">$0</div>
                </div>
            </div>
        </div>
        
        <!-- Production Rates Reference -->
        <div class="production-rates">
            <h2>Industry Production Rates Reference</h2>
            <table class="rates-table">
                <thead>
                    <tr>
                        <th>Task</th>
                        <th>Production Rate</th>
                        <th>Equipment</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Strip Floor - Good Condition</td>
                        <td>1,200 sq ft/day (2 people)</td>
                        <td>175rpm 20" Floor Machine + Wet Vacuum</td>
                        <td>~150 sq ft/hr per person - ISSA realistic</td>
                    </tr>
                    <tr>
                        <td>Scrub Floor (No Strip)</td>
                        <td>3,000 sq ft/day (2 people)</td>
                        <td>Auto Scrubber or 175rpm Machine</td>
                        <td>Surface cleaning, no finish removal</td>
                    </tr>
                    <tr>
                        <td>Apply Finish - 4 Coats</td>
                        <td>2,000 sq ft/day (2 people)</td>
                        <td>18" Microfiber Mop & Bucket</td>
                        <td>Standard for full strip & refinish</td>
                    </tr>
                    <tr>
                        <td>Apply Top Coat - 1-2 Coats</td>
                        <td>4,000 sq ft/day (2 people)</td>
                        <td>18" Microfiber Mop & Bucket</td>
                        <td>Over existing finish (scrub & recoat)</td>
                    </tr>
                    <tr>
                        <td>Burnishing (Add-on Service)</td>
                        <td>8,000 sq ft/day (1 person)</td>
                        <td>1500+ rpm 20" Burnisher</td>
                        <td>High-gloss finish, glass-like appearance</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Detailed Breakdown -->
        <div class="breakdown-section" id="breakdownSection" style="display: none;">
            <h2>Detailed Cost Breakdown</h2>
            <div id="detailedBreakdown"></div>
            
            <h3 style="margin-top: 25px; color: #1E3A8A;">Material Calculator</h3>
            <div class="material-calc" id="materialCalc"></div>
        </div>
    </div>

    <script>
        // Production rates for different service types
        const productionRates = {
            strip_refinish: {
                strip: {
                    good: 1200,
                    fair: 1000,
                    poor: 800,
                    very_poor: 600
                },
                finish: {
                    3: 2400,
                    4: 2000,
                    5: 1600,
                    6: 1400
                },
                prep: 4000
            },
            scrub_topcoat: {
                scrub: {
                    good: 3000,
                    fair: 2500,
                    poor: 2000,
                    very_poor: 1500
                },
                finish: {
                    1: 6000,
                    2: 4000,
                    3: 3000
                },
                prep: 5000
            }
        };
        
        // Burnishing production rates
        const burnishingRates = {
            good: 8000,
            fair: 6000,
            poor: 4000,
            very_poor: 3000
        };
        
        // Material coverage rates - SC Johnson specific
        const materialCoverage = {
            stripper: 600,
            sealer: 3000,
            finish: 3000
        };
        
        // Material costs calculated from case prices
        function getMaterialCosts() {
            const stripperCasePrice = parseFloat(document.getElementById('stripperCasePrice').value) || 90;
            const finishCasePrice = parseFloat(document.getElementById('finishCasePrice').value) || 140;
            
            return {
                stripper: stripperCasePrice / 2,
                finish: finishCasePrice / 5,
                pads: 3.50,
                supplies: 0.03
            };
        }
        
        function updateServiceType() {
            const serviceType = document.getElementById('serviceType').value;
            const description = document.getElementById('serviceDescription');
            const coatsSelect = document.getElementById('coats');
            
            if (serviceType === 'strip_refinish') {
                description.textContent = 'Complete removal of old finish + 4 new coats';
                coatsSelect.innerHTML = `
                    <option value="4">4 Coats (Standard)</option>
                    <option value="5">5 Coats (High Traffic)</option>
                    <option value="6">6 Coats (Premium/High Sheen)</option>
                    <option value="3">3 Coats (Light Traffic)</option>
                `;
            } else {
                description.textContent = 'Light scrub + 1-2 top coats over existing finish';
                coatsSelect.innerHTML = `
                    <option value="1">1 Coat (Light Refresh)</option>
                    <option value="2">2 Coats (Standard)</option>
                    <option value="3">3 Coats (Heavy Traffic)</option>
                `;
            }
            calculatePricing();
        }
        
        function updateICBreakdown() {
            const rawRate = parseFloat(document.getElementById('rawLaborRate').value) || 18.00;
            const stateTaxRate = parseFloat(document.getElementById('stateTax').value) || 0;
            const icProfitRate = parseFloat(document.getElementById('icProfitRate').value) || 10;
            
            // Calculate each component
            const fica = rawRate * 0.0765;
            const futa = rawRate * 0.0060;
            const workComp = rawRate * 0.0250;
            const gl = rawRate * 0.0050;
            const stateTax = rawRate * (stateTaxRate / 100);
            
            const subTotal = rawRate + fica + futa + workComp + gl + stateTax;
            const icProfit = subTotal * (icProfitRate / 100);
            const icLoadedRate = subTotal + icProfit;
            
            // Update display
            document.getElementById('ficaAmount').textContent = '$' + fica.toFixed(2);
            document.getElementById('futaAmount').textContent = '$' + futa.toFixed(2);
            document.getElementById('workCompAmount').textContent = '$' + workComp.toFixed(2);
            document.getElementById('glAmount').textContent = '$' + gl.toFixed(2);
            document.getElementById('stateTaxAmount').textContent = '$' + stateTax.toFixed(2);
            document.getElementById('subTotal').innerHTML = '<strong>$' + subTotal.toFixed(2) + '</strong>';
            document.getElementById('icProfitAmount').textContent = '$' + icProfit.toFixed(2);
            document.getElementById('icLoadedRate').innerHTML = '<strong>$' + icLoadedRate.toFixed(2) + '</strong>';
            
            calculatePricing();
        }
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        function formatCurrencyDetailed(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }
        
        function calculatePricing() {
            try {
                const squareFootage = parseFloat(document.getElementById('squareFootage').value) || 0;
                const serviceType = document.getElementById('serviceType').value;
                const addBurnishing = document.getElementById('addBurnishing').checked;
                const condition = document.getElementById('condition').value;
                const density = document.getElementById('density').value;
                const coats = parseInt(document.getElementById('coats').value) || 0;
                const icLoadedRateText = document.getElementById('icLoadedRate').textContent.replace(/[$,]/g, '');
                const icLoadedRate = parseFloat(icLoadedRateText) || 22.03;
                const equipmentRate = parseFloat(document.getElementById('equipmentRate').value) || 8;
                const crewSize = parseInt(document.getElementById('crewSize').value);
                const cwMargin = parseFloat(document.getElementById('cwMargin').value) || 35;
                const timeOfService = document.getElementById('timeOfService').value;
                
                if (squareFootage <= 0) {
                    return;
                }
                
                // Get production rates based on service type
                const rates = productionRates[serviceType];
                let primaryTaskHours, finishHours = 0, prepHours, burnishingHours = 0;
                let primaryTaskName;
                
                if (serviceType === 'strip_refinish') {
                    primaryTaskHours = (squareFootage / rates.strip[condition] * 8);
                    finishHours = (squareFootage / rates.finish[coats] * 8);
                    prepHours = (squareFootage / rates.prep * 8);
                    primaryTaskName = 'Stripping';
                } else {
                    primaryTaskHours = (squareFootage / rates.scrub[condition] * 8);
                    finishHours = (squareFootage / rates.finish[coats] * 8);
                    prepHours = (squareFootage / rates.prep * 8);
                    primaryTaskName = 'Scrubbing';
                }
                
                // Add burnishing if selected
                if (addBurnishing) {
                    burnishingHours = (squareFootage / burnishingRates[condition] * 8);
                }
                
                // Calculate density multiplier
                let densityMultiplier = 1.0;
                let furnitureDescription = "";
                
                switch(density) {
                    case 'none':
                        densityMultiplier = 0.9;
                        furnitureDescription = "No furniture to move";
                        break;
                    case 'minimal':
                        densityMultiplier = 1.0;
                        furnitureDescription = "Minimal furniture moving";
                        break;
                    case 'light':
                        densityMultiplier = 1.15;
                        furnitureDescription = "Light furniture moving";
                        break;
                    case 'medium':
                        densityMultiplier = 1.3;
                        furnitureDescription = "Moderate furniture moving";
                        break;
                    case 'heavy':
                        densityMultiplier = 1.5;
                        furnitureDescription = "Heavy furniture moving";
                        break;
                    case 'very_heavy':
                        densityMultiplier = 1.8;
                        furnitureDescription = "Extensive furniture/equipment moving";
                        break;
                    default:
                        densityMultiplier = 1.0;
                        furnitureDescription = "Standard conditions";
                }
                
                // Apply density multiplier
                primaryTaskHours *= densityMultiplier;
                finishHours *= densityMultiplier;
                burnishingHours *= densityMultiplier;
                
                let totalHours = primaryTaskHours + finishHours + prepHours + burnishingHours;
                
                // Time of service multiplier
                let timeMultiplier = 1.0;
                if (timeOfService === 'third_shift') timeMultiplier = 1.25;
                
                // Material calculations
                const materialCosts = getMaterialCosts();
                let stripperGallons = 0;
                let finishGallons = 0;
                
                if (serviceType === 'strip_refinish') {
                    stripperGallons = Math.ceil(squareFootage / materialCoverage.stripper);
                    finishGallons = Math.ceil((squareFootage * coats) / materialCoverage.finish);
                } else {
                    finishGallons = Math.ceil((squareFootage * coats) / materialCoverage.finish);
                }
                
                const stripperCost = stripperGallons * materialCosts.stripper;
                const finishCost = finishGallons * materialCosts.finish;
                const padsCost = Math.ceil(squareFootage / 2000) * materialCosts.pads;
                const suppliesCost = squareFootage * materialCosts.supplies;
                
                const baseMaterialCost = stripperCost + finishCost + padsCost + suppliesCost;
                
                // Handle crew size
                let finalVendorRate = icLoadedRate;
                if (crewSize > 1) {
                    totalHours = totalHours / crewSize;
                    finalVendorRate = icLoadedRate * crewSize;
                }
                
                // Calculate costs
                const vendorLaborCost = totalHours * finalVendorRate * timeMultiplier;
                const equipmentCost = totalHours * equipmentRate;
                const totalCostToCW = vendorLaborCost + equipmentCost + baseMaterialCost;
                const finalClientPrice = totalCostToCW / (1 - cwMargin/100);
                const cwGrossProfit = finalClientPrice - totalCostToCW;
                const pricePerSqFt = finalClientPrice / squareFootage;
                const materialCostWithMargin = baseMaterialCost / (1 - cwMargin/100);
                
                // Update display
                document.getElementById('totalHours').textContent = totalHours.toFixed(1);
                document.getElementById('vendorLaborCost').textContent = formatCurrency(vendorLaborCost);
                document.getElementById('equipmentCost').textContent = formatCurrency(equipmentCost);
                document.getElementById('materialCost').textContent = formatCurrency(materialCostWithMargin);
                document.getElementById('totalCost').textContent = formatCurrency(totalCostToCW);
                document.getElementById('pricePerSqFt').textContent = formatCurrencyDetailed(pricePerSqFt);
                document.getElementById('bidPrice').textContent = formatCurrency(finalClientPrice);
                document.getElementById('cwProfit').textContent = formatCurrency(cwGrossProfit);
                
                // Show results
                document.getElementById('resultsSection').style.display = 'block';
                document.getElementById('breakdownSection').style.display = 'block';
                
                // Generate breakdown
                generateDetailedBreakdown({
                    squareFootage: squareFootage,
                    serviceType: serviceType,
                    addBurnishing: addBurnishing,
                    primaryTaskHours: primaryTaskHours.toFixed(1),
                    finishHours: finishHours.toFixed(1),
                    prepHours: prepHours.toFixed(1),
                    burnishingHours: burnishingHours.toFixed(1),
                    primaryTaskName: primaryTaskName,
                    stripperGallons: stripperGallons,
                    finishGallons: finishGallons,
                    stripperCost: stripperCost,
                    finishCost: finishCost,
                    padsCost: padsCost,
                    suppliesCost: suppliesCost,
                    baseMaterialCost: baseMaterialCost,
                    materialCostWithMargin: materialCostWithMargin,
                    vendorLaborCost: vendorLaborCost,
                    equipmentCost: equipmentCost,
                    totalCostToCW: totalCostToCW,
                    finalClientPrice: finalClientPrice,
                    cwGrossProfit: cwGrossProfit,
                    timeMultiplier: timeMultiplier,
                    cwMargin: cwMargin,
                    rawLaborRate: parseFloat(document.getElementById('rawLaborRate').value) || 18,
                    vendorLoadedRate: finalVendorRate,
                    crewSize: crewSize,
                    furnitureDescription: furnitureDescription,
                    stripperCasePrice: parseFloat(document.getElementById('stripperCasePrice').value) || 90,
                    finishCasePrice: parseFloat(document.getElementById('finishCasePrice').value) || 140,
                    coats: coats
                });
                
            } catch (error) {
                console.error('Error in calculatePricing:', error);
            }
        }
        
        function generateDetailedBreakdown(data) {
            try {
                const furnitureDesc = data.furnitureDescription || "Standard conditions";
                const rawRate = data.rawLaborRate || 18;
                const vendorRate = data.vendorLoadedRate || 22.03;
                const serviceTypeText = data.serviceType === 'strip_refinish' ? 'Strip & Refinish' : 'Scrub & Top Coat';
                const burnishingText = data.addBurnishing ? ' + Burnishing' : '';
                const fullServiceText = serviceTypeText + burnishingText;
                
                const breakdownHtml = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #DC2626;">
                            <h4 style="color: #DC2626; margin-bottom: 15px;">Labor Cost Structure</h4>
                            <p><strong>Raw Labor Rate:</strong> ${formatCurrencyDetailed(rawRate)}/hr</p>
                            <p><strong>IC Loaded Rate:</strong> ${formatCurrencyDetailed(vendorRate)}/hr</p>
                            <p><strong>Total Hours:</strong> ${(parseFloat(data.primaryTaskHours) + parseFloat(data.finishHours) + parseFloat(data.prepHours) + parseFloat(data.burnishingHours || 0)).toFixed(1)} hrs</p>
                            <p><strong>Vendor Labor Cost:</strong> ${formatCurrency(data.vendorLaborCost)}</p>
                            <p><strong>Equipment Cost:</strong> ${formatCurrency(data.equipmentCost)}</p>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #3B82F6;">
                            <h4 style="color: #3B82F6; margin-bottom: 15px;">Material Cost Structure</h4>
                            <p><strong>Base Material Cost:</strong> ${formatCurrency(data.baseMaterialCost)}</p>
                            <p><strong>Stripper Case Price:</strong> ${formatCurrency(data.stripperCasePrice)}/case (2 gal)</p>
                            <p><strong>Finish Case Price:</strong> ${formatCurrency(data.finishCasePrice)}/case (5 gal)</p>
                            <p><strong>Material Cost w/ Margin:</strong> ${formatCurrency(data.materialCostWithMargin)}</p>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #1E3A8A;">
                            <h4 style="color: #1E3A8A; margin-bottom: 15px;">City Wide Pricing</h4>
                            <p><strong>Total Cost to CW:</strong> ${formatCurrency(data.totalCostToCW)}</p>
                            <p><strong>CW Margin:</strong> ${data.cwMargin}% (applies to all costs)</p>
                            <p><strong>Final Client Price:</strong> ${formatCurrency(data.finalClientPrice)}</p>
                            <p><strong>CW Gross Profit:</strong> ${formatCurrency(data.cwGrossProfit)}</p>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #059669;">
                            <h4 style="color: #059669; margin-bottom: 15px;">Service & Task Breakdown</h4>
                            <p><strong>Service Type:</strong> ${fullServiceText}</p>
                            <p><strong>${data.primaryTaskName}:</strong> ${data.primaryTaskHours} hours</p>
                            <p><strong>Finishing:</strong> ${data.finishHours} hours (${data.coats} coats)</p>
                            <p><strong>Prep Work:</strong> ${data.prepHours} hours</p>
                            ${data.addBurnishing ? `<p><strong>Burnishing:</strong> ${data.burnishingHours} hours</p>` : ''}
                            <p><strong>Furniture:</strong> ${furnitureDesc}</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('detailedBreakdown').innerHTML = breakdownHtml;
                
                const materialHtml = `
                    <div class="material-item">
                        <h4>Service Analysis</h4>
                        <p>Service: ${fullServiceText}</p>
                        <p>Finish Coats: ${data.coats}</p>
                        <p>Crew Size: ${data.crewSize} person(s)</p>
                        <p>${data.crewSize > 1 ? 'Faster completion, same cost/sq ft' : 'Standard single-person rate'}</p>
                    </div>
                    <div class="material-item">
                        <h4>IC Rate Analysis</h4>
                        <p>Raw Rate: ${formatCurrencyDetailed(rawRate)}/hr</p>
                        <p>Load Factor: ${((vendorRate / rawRate - 1) * 100).toFixed(0)}%</p>
                        <p>IC Loaded Rate: ${formatCurrencyDetailed(vendorRate)}/hr</p>
                    </div>
                    <div class="material-item">
                        <h4>SC Johnson Stripper ${data.stripperGallons > 0 ? '' : '(Not Used)'}</h4>
                        <p>Case Price: ${formatCurrency(data.stripperCasePrice)} (2 gal)</p>
                        <p>Per Gallon: ${formatCurrency(data.stripperCasePrice / 2)}</p>
                        <p>Coverage: ~600 sq ft/gal (diluted)</p>
                        <p>Needed: ${data.stripperGallons} gallons</p>
                    </div>
                    <div class="material-item">
                        <h4>SC Johnson Floor Finish ${data.finishGallons > 0 ? '' : '(Not Used)'}</h4>
                        <p>Case Price: ${formatCurrency(data.finishCasePrice)} (5 gal)</p>
                        <p>Per Gallon: ${formatCurrency(data.finishCasePrice / 5)}</p>
                        <p>Coverage: 3,000 sq ft/gal per coat</p>
                        <p>Needed: ${data.finishGallons} gallons</p>
                    </div>
                `;
                
                document.getElementById('materialCalc').innerHTML = materialHtml;
                
            } catch (error) {
                console.error('Error in generateDetailedBreakdown:', error);
            }
        }
        
        // Initialize on page load
        window.onload = function() {
            try {
                updateICBreakdown();
                updateServiceType();
                calculatePricing();
            } catch (error) {
                console.error('Error on page load:', error);
            }
        };
    </script>
</body>
</html>
