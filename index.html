<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Wide Strip & Wax Floor Pricing Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .section h2 {
            color: #374151;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #DC2626;
            padding-bottom: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #1E3A8A;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        
        .input-group small {
            display: block;
            margin-top: 5px;
            font-size: 12px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        .ic-breakdown {
            background: #F3F4F6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #1E3A8A;
        }
        
        .ic-breakdown h4 {
            color: #1E3A8A;
            margin-bottom: 10px;
        }
        
        .ic-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .ic-row input {
            width: 80px;
            text-align: right;
        }
        
        .btn {
            background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.3);
        }
        
        .results-section {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 30px;
            margin-top: 20px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #374151;
        }
        
        .result-card h3 {
            color: #374151;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .result-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #374151;
        }
        
        .result-card.highlight {
            border-left-color: #DC2626;
        }
        
        .result-card.highlight .value {
            color: #DC2626;
        }
        
        .production-rates {
            grid-column: 1 / -1;
            margin-top: 30px;
        }
        
        .rates-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .rates-table th {
            background: #374151;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .rates-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .rates-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .rates-table tr:hover {
            background: #e3f2fd;
        }
        
        .breakdown-section {
            grid-column: 1 / -1;
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid #dee2e6;
        }
        
        .material-calc {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .toggle-section {
            grid-column: 1 / -1;
            background: #F3F4F6;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #059669;
        }
        
        .toggle-section h2 {
            color: #059669;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #059669;
            padding-bottom: 10px;
        }
        
        .toggle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .toggle-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            transition: border-color 0.3s ease;
        }
        
        .toggle-item.vendor {
            border-color: #DC2626;
            background: #FEF2F2;
        }
        
        .toggle-item.inhouse {
            border-color: #059669;
            background: #F0FDF4;
        }
        
        .toggle-item h4 {
            margin-bottom: 10px;
            color: #374151;
            font-size: 1.1em;
        }
        
        .toggle-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .toggle-btn {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .toggle-btn.active.vendor {
            background: #DC2626;
            color: white;
            border-color: #DC2626;
        }
        
        .toggle-btn.active.inhouse {
            background: #059669;
            color: white;
            border-color: #059669;
        }
        
        .toggle-description {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Strip & Wax Floor Pricing Calculator</h1>
            <p>Professional Time & Material Calculations Based on Industry Standards</p>
        </div>
        
        <div class="main-content">
            <!-- Cost Provider Toggle Section -->
            <div class="toggle-section">
                <h2>Cost Provider Selection</h2>
                <div class="toggle-grid">
                    <div class="toggle-item vendor" id="laborToggle">
                        <h4>Labor</h4>
                        <div class="toggle-buttons">
                            <button class="toggle-btn active vendor" onclick="setProvider('labor', 'vendor')">Vendor</button>
                            <button class="toggle-btn" onclick="setProvider('labor', 'inhouse')">In-House</button>
                        </div>
                        <div class="toggle-description">Vendor: +10% profit then CW margin | In-House: CW loaded rate + margin</div>
                    </div>
                    
                    <div class="toggle-item vendor" id="stripperToggle">
                        <h4>Stripper</h4>
                        <div class="toggle-buttons">
                            <button class="toggle-btn active vendor" onclick="setProvider('stripper', 'vendor')">Vendor</button>
                            <button class="toggle-btn" onclick="setProvider('stripper', 'inhouse')">In-House</button>
                        </div>
                        <div class="toggle-description">Material cost + provider markup structure</div>
                    </div>
                    
                    <div class="toggle-item vendor" id="finishToggle">
                        <h4>Floor Finish</h4>
                        <div class="toggle-buttons">
                            <button class="toggle-btn active vendor" onclick="setProvider('finish', 'vendor')">Vendor</button>
                            <button class="toggle-btn" onclick="setProvider('finish', 'inhouse')">In-House</button>
                        </div>
                        <div class="toggle-description">Material cost + provider markup structure</div>
                    </div>
                    
                    <div class="toggle-item vendor" id="padsToggle">
                        <h4>Pads & Supplies</h4>
                        <div class="toggle-buttons">
                            <button class="toggle-btn active vendor" onclick="setProvider('pads', 'vendor')">Vendor</button>
                            <button class="toggle-btn" onclick="setProvider('pads', 'inhouse')">In-House</button>
                        </div>
                        <div class="toggle-description">Consumable supplies cost + provider markup</div>
                    </div>
                    
                    <div class="toggle-item vendor" id="equipmentToggle">
                        <h4>Equipment</h4>
                        <div class="toggle-buttons">
                            <button class="toggle-btn active vendor" onclick="setProvider('equipment', 'vendor')">Vendor</button>
                            <button class="toggle-btn" onclick="setProvider('equipment', 'inhouse')">In-House</button>
                        </div>
                        <div class="toggle-description">Equipment rental/depreciation + provider markup</div>
                    </div>
                </div>
                
                <div class="cost-structure-note">
                    <h4>Cost Structure Logic:</h4>
                    <p><strong>Vendor Provided:</strong> Raw Cost + 10% IC Profit/OH â†’ Total Ã— (1 Ã· (1 - CW Margin%))</p>
                    <p><strong>In-House Provided:</strong> Raw Cost (no 10% IC profit) â†’ Total Ã— (1 Ã· (1 - CW Margin%))</p>
                    <p><strong>Labor Exception:</strong> If In-House, use CW loaded rate (includes FICA, FUTA, etc.) but no 10% IC profit</p>
                </div>
            </div>
            
            <!-- Project Details Section -->
            <div class="section">
                <h2>Project Details</h2>
                <div class="input-group">
                    <label for="serviceType">Service Type</label>
                    <select id="serviceType" onchange="updateServiceType()">
                        <option value="strip_refinish">Full Strip & Refinish</option>
                        <option value="scrub_topcoat">Scrub & Top Coat</option>
                    </select>
                    <small style="color: #666;" id="serviceDescription">Complete removal of old finish + 4 new coats</small>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="addBurnishing" onchange="calculatePricing()">
                    <label for="addBurnishing">Add Burnishing Service (High-Gloss Finish)</label>
                </div>
                
                <div class="input-group">
                    <label for="squareFootage">Total Square Footage</label>
                    <input type="number" id="squareFootage" placeholder="Enter square footage" value="5000" onchange="calculatePricing()">
                </div>
                
                <div class="input-group">
                    <label for="floorType">Floor Type</label>
                    <select id="floorType" onchange="calculatePricing()">
                        <option value="vct">VCT Tile (Standard)</option>
                        <option value="linoleum">Linoleum</option>
                        <option value="luxury_vinyl">Luxury Vinyl Tile (LVT)</option>
                        <option value="composition">Composition Tile</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="condition">Current Floor Condition</label>
                    <select id="condition" onchange="calculatePricing()">
                        <option value="good">Good - Recent maintenance</option>
                        <option value="fair">Fair - Normal wear</option>
                        <option value="poor">Poor - Heavy buildup</option>
                        <option value="very_poor">Very Poor - Multiple layers</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="density">Furniture Density & Moving</label>
                    <select id="density" onchange="calculatePricing()">
                        <option value="none">No Furniture - Open areas</option>
                        <option value="minimal">Minimal - Light furniture, easy to move</option>
                        <option value="light">Light - Some desks/chairs to move</option>
                        <option value="medium">Medium - Moderate furniture density</option>
                        <option value="heavy">Heavy - Dense furniture, complex moving</option>
                        <option value="very_heavy">Very Heavy - Extensive furniture/equipment</option>
                    </select>
                </div>
                
                <div class="input-group" id="coatsGroup">
                    <label for="coats">Number of Finish Coats</label>
                    <select id="coats" onchange="calculatePricing()">
                        <option value="4">4 Coats (Standard)</option>
                        <option value="5">5 Coats (High Traffic)</option>
                        <option value="6">6 Coats (Premium/High Sheen)</option>
                        <option value="3">3 Coats (Light Traffic)</option>
                    </select>
                </div>
            </div>
            
            <!-- Vendor Labor & Equipment Section -->
            <div class="section">
                <h2>Vendor Labor & Equipment</h2>
                
                <!-- IC Rate Breakdown -->
                <div class="ic-breakdown">
                    <h4>Independent Contractor Rate Breakdown</h4>
                    <div class="ic-row">
                        <label>Raw Labor Rate:</label>
                        <span>$</span>
                        <input type="number" id="rawLaborRate" step="0.01" value="18.00" onchange="updateICBreakdown()">
                    </div>
                    <div class="ic-row">
                        <label>FICA (7.65%):</label>
                        <span id="ficaAmount">$1.38</span>
                    </div>
                    <div class="ic-row">
                        <label>FUTA (0.60%):</label>
                        <span id="futaAmount">$0.11</span>
                    </div>
                    <div class="ic-row">
                        <label>Work Comp (2.50%):</label>
                        <span id="workCompAmount">$0.45</span>
                    </div>
                    <div class="ic-row">
                        <label>GL (0.50%):</label>
                        <span id="glAmount">$0.09</span>
                    </div>
                    <div class="ic-row">
                        <label>State Income Tax (%):</label>
                        <input type="number" id="stateTax" step="0.01" value="0.00" onchange="updateICBreakdown()">
                        <span id="stateTaxAmount">$0.00</span>
                    </div>
                    <div class="ic-row" style="border-top: 1px solid #ddd; padding-top: 8px; margin-top: 8px;">
                        <label><strong>Sub Total:</strong></label>
                        <span id="subTotal"><strong>$20.03</strong></span>
                    </div>
                    <div class="ic-row">
                        <label>IC Profit & OH (%):</label>
                        <input type="number" id="icProfitRate" step="0.1" value="10.0" onchange="updateICBreakdown()">
                        <span id="icProfitAmount">$2.00</span>
                    </div>
                    <div class="ic-row" style="border-top: 2px solid #1E3A8A; padding-top: 8px; margin-top: 8px;">
                        <label><strong>IC Loaded Rate:</strong></label>
                        <span id="icLoadedRate"><strong>$22.03</strong></span>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="stripperCasePrice">SC Johnson Stripper Price ($/case)</label>
                    <input type="number" id="stripperCasePrice" step="1.00" value="90.00" onchange="calculatePricing()">
                    <small style="color: #666;">2-gallon concentrate case, makes up to 50 gallons diluted</small>
                </div>
                
                <div class="input-group">
                    <label for="finishCasePrice">SC Johnson Finish Price ($/case)</label>
                    <input type="number" id="finishCasePrice" step="1.00" value="140.00" onchange="calculatePricing()">
                    <small style="color: #666;">5-gallon case, ready-to-use finish</small>
                </div>
                
                <div class="input-group">
                    <label for="crewSize">Crew Size</label>
                    <select id="crewSize" onchange="calculatePricing()">
                        <option value="1">1 Person</option>
                        <option value="2" selected>2 People (Recommended)</option>
                        <option value="3">3 People (Large Areas)</option>
                        <option value="4">4 People (Very Large Areas)</option>
                        <option value="5">5 People (Massive Projects)</option>
                        <option value="6">6 People (Stadium/Arena Size)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="equipmentRate">Equipment Rate ($/hour)</label>
                    <input type="number" id="equipmentRate" step="0.50" value="8.00" onchange="calculatePricing()">
                    <small style="color: #666;">Covers transport, setup, depreciation & maintenance</small>
                </div>
                
                <div class="input-group">
                    <label for="cwMargin">City Wide Margin (%)</label>
                    <input type="number" id="cwMargin" step="1" value="35" min="0" max="50" onchange="calculatePricing()">
                    <small style="color: #666;">Applied to both labor and materials (divide cost by 0.65)</small>
                </div>
                
                <div class="input-group">
                    <label for="timeOfService">Time of Service</label>
                    <select id="timeOfService" onchange="calculatePricing()">
                        <option value="normal">Normal Hours</option>
                        <option value="third_shift">Third Shift (Midnight-6am) (+25%)</option>
                    </select>
                </div>
                
                <button class="btn" onclick="calculatePricing()">Calculate Strip & Wax Pricing</button>
            </div>
        </div>
        
        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <h2>Pricing Results</h2>
            <div class="results-grid">
                <div class="result-card">
                    <h3>Total Labor Hours</h3>
                    <div class="value" id="totalHours">0</div>
                </div>
                <div class="result-card">
                    <h3>Vendor Labor Cost</h3>
                    <div class="value" id="vendorLaborCost">$0</div>
                </div>
                <div class="result-card">
                    <h3>Equipment Cost</h3>
                    <div class="value" id="equipmentCost">$0</div>
                </div>
                <div class="result-card">
                    <h3>Material Cost (w/ Margin)</h3>
                    <div class="value" id="materialCost">$0</div>
                </div>
                <div class="result-card">
                    <h3>Total Due to Vendor</h3>
                    <div class="value" id="totalDueVendor">$0</div>
                </div>
                <div class="result-card">
                    <h3>Price Per Sq Ft</h3>
                    <div class="value" id="pricePerSqFt">$0.00</div>
                </div>
                <div class="result-card highlight">
                    <h3>Final Client Price</h3>
                    <div class="value" id="bidPrice">$0</div>
                </div>
                <div class="result-card highlight">
                    <h3>CW Gross Profit</h3>
                    <div class="value" id="cwProfit">$0</div>
                </div>
            </div>
        </div>
        
        <!-- Production Rates Reference -->
        <div class="production-rates">
            <h2>Industry Production Rates Reference</h2>
            <table class="rates-table">
                <thead>
                    <tr>
                        <th>Task</th>
                        <th>Production Rate</th>
                        <th>Equipment</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Strip Floor - Good Condition</td>
                        <td>1,200 sq ft/day (2 people)</td>
                        <td>175rpm 20" Floor Machine + Wet Vacuum</td>
                        <td>~150 sq ft/hr per person - ISSA realistic</td>
                    </tr>
                    <tr>
                        <td>Scrub Floor (No Strip)</td>
                        <td>3,000 sq ft/day (2 people)</td>
                        <td>Auto Scrubber or 175rpm Machine</td>
                        <td>Surface cleaning, no finish removal</td>
                    </tr>
                    <tr>
                        <td>Apply Finish - 4 Coats</td>
                        <td>2,000 sq ft/day (2 people)</td>
                        <td>18" Microfiber Mop & Bucket</td>
                        <td>Standard for full strip & refinish</td>
                    </tr>
                    <tr>
                        <td>Apply Top Coat - 1-2 Coats</td>
                        <td>4,000 sq ft/day (2 people)</td>
                        <td>18" Microfiber Mop & Bucket</td>
                        <td>Over existing finish (scrub & recoat)</td>
                    </tr>
                    <tr>
                        <td>Burnishing (Add-on Service)</td>
                        <td>8,000 sq ft/day (1 person)</td>
                        <td>1500+ rpm 20" Burnisher</td>
                        <td>High-gloss finish, glass-like appearance</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Detailed Breakdown -->
        <div class="breakdown-section" id="breakdownSection" style="display: none;">
            <h2>Detailed Cost Breakdown</h2>
            <div id="detailedBreakdown"></div>
            
            <h3 style="margin-top: 25px; color: #1E3A8A;">Material Calculator</h3>
            <div class="material-calc" id="materialCalc"></div>
        </div>
        
        <!-- Export Section -->
        <div class="export-section">
            <h2>Export Project Documentation</h2>
            <p style="color: #666; margin-bottom: 20px;">Generate professional PDFs for vendors and clients with relevant project information</p>
            
            <div class="export-buttons">
                <button class="export-btn vendor" onclick="generateVendorPDF()">
                    ðŸ“‹ Generate Vendor Specifications
                </button>
                <button class="export-btn" onclick="generateClientPDF()">
                    ðŸ“„ Generate Client Instructions
                </button>
            </div>
            
            <div style="margin-top: 15px; font-size: 14px; color: #666;">
                <p><strong>Vendor PDF:</strong> Material quantities, labor hours, equipment needs, project specifications</p>
                <p><strong>Client PDF:</strong> Service overview, preparation requirements, curing instructions, care guidelines</p>
            </div>
        </div>
    </div>

    <script>
        // Cost provider tracking
        const costProviders = {
            labor: 'vendor',
            stripper: 'vendor', 
            finish: 'vendor',
            pads: 'vendor',
            equipment: 'vendor'
        };
        
        function setProvider(item, provider) {
            costProviders[item] = provider;
            
            // Update UI
            const toggleItem = document.getElementById(item + 'Toggle');
            const buttons = toggleItem.querySelectorAll('.toggle-btn');
            
            // Remove active class from all buttons
            buttons.forEach(btn => btn.classList.remove('active', 'vendor', 'inhouse'));
            
            // Add active class to selected button
            const activeButton = provider === 'vendor' ? buttons[0] : buttons[1];
            activeButton.classList.add('active', provider);
            
            // Update container styling
            toggleItem.classList.remove('vendor', 'inhouse');
            toggleItem.classList.add(provider);
            
            // Recalculate pricing
            calculatePricing();
        }
        
        // Production rates for different service types
        const productionRates = {
            strip_refinish: {
                strip: {
                    good: 1200,
                    fair: 1000,
                    poor: 800,
                    very_poor: 600
                },
                finish: {
                    3: 2400,
                    4: 2000,
                    5: 1600,
                    6: 1400
                },
                prep: 4000
            },
            scrub_topcoat: {
                scrub: {
                    good: 3000,
                    fair: 2500,
                    poor: 2000,
                    very_poor: 1500
                },
                finish: {
                    1: 6000,
                    2: 4000,
                    3: 3000
                },
                prep: 5000
            }
        };
        
        // Burnishing production rates
        const burnishingRates = {
            good: 8000,
            fair: 6000,
            poor: 4000,
            very_poor: 3000
        };
        
        // Material coverage rates - SC Johnson specific
        const materialCoverage = {
            stripper: 600,
            sealer: 3000,
            finish: 3000
        };
        
        // Material costs calculated from case prices
        function getMaterialCosts() {
            const stripperCasePrice = parseFloat(document.getElementById('stripperCasePrice').value) || 90;
            const finishCasePrice = parseFloat(document.getElementById('finishCasePrice').value) || 140;
            
            return {
                stripper: stripperCasePrice / 2,
                finish: finishCasePrice / 5,
                pads: 3.50,
                supplies: 0.03
            };
        }
        
        function updateServiceType() {
            const serviceType = document.getElementById('serviceType').value;
            const description = document.getElementById('serviceDescription');
            const coatsSelect = document.getElementById('coats');
            
            if (serviceType === 'strip_refinish') {
                description.textContent = 'Complete removal of old finish + 4 new coats';
                coatsSelect.innerHTML = `
                    <option value="4">4 Coats (Standard)</option>
                    <option value="5">5 Coats (High Traffic)</option>
                    <option value="6">6 Coats (Premium/High Sheen)</option>
                    <option value="3">3 Coats (Light Traffic)</option>
                `;
            } else {
                description.textContent = 'Light scrub + 1-2 top coats over existing finish';
                coatsSelect.innerHTML = `
                    <option value="1">1 Coat (Light Refresh)</option>
                    <option value="2">2 Coats (Standard)</option>
                    <option value="3">3 Coats (Heavy Traffic)</option>
                `;
            }
            calculatePricing();
        }
        
        function calculateInHouseLoadedRate(rawRate) {
            // Calculate in-house loaded rate (all costs except IC profit)
            const stateTaxRate = parseFloat(document.getElementById('stateTax').value) || 0;
            
            const fica = rawRate * 0.0765;
            const futa = rawRate * 0.0060;
            const workComp = rawRate * 0.0250;
            const gl = rawRate * 0.0050;
            const stateTax = rawRate * (stateTaxRate / 100);
            
            return rawRate + fica + futa + workComp + gl + stateTax;
        }
        
        function calculateMaterialCosts(stripperCost, finishCost, padsCost, suppliesCost, cwMargin) {
            let stripperTotal, finishTotal, padsTotal;
            
            // Stripper cost
            if (costProviders.stripper === 'vendor') {
                const stripperWithICProfit = stripperCost * 1.10;
                stripperTotal = stripperWithICProfit / (1 - cwMargin/100);
            } else {
                stripperTotal = stripperCost / (1 - cwMargin/100);
            }
            
            // Finish cost  
            if (costProviders.finish === 'vendor') {
                const finishWithICProfit = finishCost * 1.10;
                finishTotal = finishWithICProfit / (1 - cwMargin/100);
            } else {
                finishTotal = finishCost / (1 - cwMargin/100);
            }
            
            // Pads and supplies cost
            if (costProviders.pads === 'vendor') {
                const padsWithICProfit = (padsCost + suppliesCost) * 1.10;
                padsTotal = padsWithICProfit / (1 - cwMargin/100);
            } else {
                padsTotal = (padsCost + suppliesCost) / (1 - cwMargin/100);
            }
            
            return {
                stripper: stripperTotal,
                finish: finishTotal,
                pads: padsTotal,
                total: stripperTotal + finishTotal + padsTotal
            };
        }
        
        function calculateBaseCosts(totalHours, finalVendorRate, timeMultiplier, equipmentRate, stripperCost, finishCost, padsCost, suppliesCost) {
            // Calculate base costs without any markups for profit calculation
            const baseLaborCost = totalHours * finalVendorRate * timeMultiplier;
            const baseEquipmentCost = totalHours * equipmentRate;
            const baseMaterialCost = stripperCost + finishCost + padsCost + suppliesCost;
            
            return baseLaborCost + baseEquipmentCost + baseMaterialCost;
        }
        
        function updateICBreakdown() {
            const rawRate = parseFloat(document.getElementById('rawLaborRate').value) || 18.00;
            const stateTaxRate = parseFloat(document.getElementById('stateTax').value) || 0;
            const icProfitRate = parseFloat(document.getElementById('icProfitRate').value) || 10;
            
            // Calculate each component
            const fica = rawRate * 0.0765;
            const futa = rawRate * 0.0060;
            const workComp = rawRate * 0.0250;
            const gl = rawRate * 0.0050;
            const stateTax = rawRate * (stateTaxRate / 100);
            
            const subTotal = rawRate + fica + futa + workComp + gl + stateTax;
            const icProfit = subTotal * (icProfitRate / 100);
            const icLoadedRate = subTotal + icProfit;
            
            // Update display
            document.getElementById('ficaAmount').textContent = '$' + fica.toFixed(2);
            document.getElementById('futaAmount').textContent = '$' + futa.toFixed(2);
            document.getElementById('workCompAmount').textContent = '$' + workComp.toFixed(2);
            document.getElementById('glAmount').textContent = '$' + gl.toFixed(2);
            document.getElementById('stateTaxAmount').textContent = '$' + stateTax.toFixed(2);
            document.getElementById('subTotal').innerHTML = '<strong>$' + subTotal.toFixed(2) + '</strong>';
            document.getElementById('icProfitAmount').textContent = '$' + icProfit.toFixed(2);
            document.getElementById('icLoadedRate').innerHTML = '<strong>$' + icLoadedRate.toFixed(2) + '</strong>';
            
            calculatePricing();
        }
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        function formatCurrencyDetailed(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }
        
        function calculatePricing() {
            try {
                const squareFootage = parseFloat(document.getElementById('squareFootage').value) || 0;
                const serviceType = document.getElementById('serviceType').value;
                const addBurnishing = document.getElementById('addBurnishing').checked;
                const condition = document.getElementById('condition').value;
                const density = document.getElementById('density').value;
                const coats = parseInt(document.getElementById('coats').value) || 0;
                const icLoadedRateText = document.getElementById('icLoadedRate').textContent.replace(/[$,]/g, '');
                const icLoadedRate = parseFloat(icLoadedRateText) || 22.03;
                const equipmentRate = parseFloat(document.getElementById('equipmentRate').value) || 8;
                const crewSize = parseInt(document.getElementById('crewSize').value);
                const cwMargin = parseFloat(document.getElementById('cwMargin').value) || 35;
                const timeOfService = document.getElementById('timeOfService').value;
                
                if (squareFootage <= 0) {
                    return;
                }
                
                // Get production rates based on service type
                const rates = productionRates[serviceType];
                let primaryTaskHours, finishHours = 0, prepHours, burnishingHours = 0;
                let primaryTaskName;
                
                if (serviceType === 'strip_refinish') {
                    primaryTaskHours = (squareFootage / rates.strip[condition] * 8);
                    finishHours = (squareFootage / rates.finish[coats] * 8);
                    prepHours = (squareFootage / rates.prep * 8);
                    primaryTaskName = 'Stripping';
                } else {
                    primaryTaskHours = (squareFootage / rates.scrub[condition] * 8);
                    finishHours = (squareFootage / rates.finish[coats] * 8);
                    prepHours = (squareFootage / rates.prep * 8);
                    primaryTaskName = 'Scrubbing';
                }
                
                // Add burnishing if selected
                if (addBurnishing) {
                    burnishingHours = (squareFootage / burnishingRates[condition] * 8);
                }
                
                // Calculate density multiplier
                let densityMultiplier = 1.0;
                let furnitureDescription = "";
                
                switch(density) {
                    case 'none':
                        densityMultiplier = 0.9;
                        furnitureDescription = "No furniture to move";
                        break;
                    case 'minimal':
                        densityMultiplier = 1.0;
                        furnitureDescription = "Minimal furniture moving";
                        break;
                    case 'light':
                        densityMultiplier = 1.15;
                        furnitureDescription = "Light furniture moving";
                        break;
                    case 'medium':
                        densityMultiplier = 1.3;
                        furnitureDescription = "Moderate furniture moving";
                        break;
                    case 'heavy':
                        densityMultiplier = 1.5;
                        furnitureDescription = "Heavy furniture moving";
                        break;
                    case 'very_heavy':
                        densityMultiplier = 1.8;
                        furnitureDescription = "Extensive furniture/equipment moving";
                        break;
                    default:
                        densityMultiplier = 1.0;
                        furnitureDescription = "Standard conditions";
                }
                
                // Apply density multiplier
                primaryTaskHours *= densityMultiplier;
                finishHours *= densityMultiplier;
                burnishingHours *= densityMultiplier;
                
                let totalHours = primaryTaskHours + finishHours + prepHours + burnishingHours;
                
                // Time of service multiplier
                let timeMultiplier = 1.0;
                if (timeOfService === 'third_shift') timeMultiplier = 1.25;
                
                // Material calculations
                const materialCosts = getMaterialCosts();
                let stripperGallons = 0;
                let finishGallons = 0;
                
                if (serviceType === 'strip_refinish') {
                    stripperGallons = Math.ceil(squareFootage / materialCoverage.stripper);
                    finishGallons = Math.ceil((squareFootage * coats) / materialCoverage.finish);
                } else {
                    finishGallons = Math.ceil((squareFootage * coats) / materialCoverage.finish);
                }
                
                const stripperCost = stripperGallons * materialCosts.stripper;
                const finishCost = finishGallons * materialCosts.finish;
                const padsCost = Math.ceil(squareFootage / 2000) * materialCosts.pads;
                const suppliesCost = squareFootage * materialCosts.supplies;
                
                const baseMaterialCost = stripperCost + finishCost + padsCost + suppliesCost;
                
                // Handle crew size
                let finalVendorRate = icLoadedRate;
                if (crewSize > 1) {
                    totalHours = totalHours / crewSize;
                    finalVendorRate = icLoadedRate * crewSize;
                }
                
                // Calculate costs with provider-specific markup
                let vendorLaborCost, equipmentCost, finalMaterialCosts;
                
                // Labor cost calculation
                if (costProviders.labor === 'vendor') {
                    // Vendor provides: IC rate with 10% profit, then CW margin
                    const vendorLaborBase = totalHours * finalVendorRate * timeMultiplier;
                    vendorLaborCost = vendorLaborBase / (1 - cwMargin/100);
                } else {
                    // In-house: Use loaded rate (no 10% IC profit) then CW margin
                    const rawRate = parseFloat(document.getElementById('rawLaborRate').value) || 18;
                    const inHouseRate = calculateInHouseLoadedRate(rawRate);
                    let inHouseFinalRate = inHouseRate;
                    if (crewSize > 1) {
                        inHouseFinalRate = inHouseRate * crewSize;
                    }
                    const inHouseLaborBase = totalHours * inHouseFinalRate * timeMultiplier;
                    vendorLaborCost = inHouseLaborBase / (1 - cwMargin/100);
                }
                
                // Equipment cost calculation
                if (costProviders.equipment === 'vendor') {
                    // Vendor provides: Base cost + 10% IC profit, then CW margin
                    const equipmentBase = totalHours * equipmentRate;
                    const equipmentWithICProfit = equipmentBase * 1.10;
                    equipmentCost = equipmentWithICProfit / (1 - cwMargin/100);
                } else {
                    // In-house: Base cost, then CW margin (no 10% IC profit)
                    const equipmentBase = totalHours * equipmentRate;
                    equipmentCost = equipmentBase / (1 - cwMargin/100);
                }
                
                // Material costs calculation
                finalMaterialCosts = calculateMaterialCosts(stripperCost, finishCost, padsCost, suppliesCost, cwMargin);
                
                // Calculate total due to vendor (what FSM actually pays)
                let totalDueToVendor = 0;
                
                // Add vendor labor cost (only if vendor provides labor)
                if (costProviders.labor === 'vendor') {
                    totalDueToVendor += totalHours * finalVendorRate * timeMultiplier;
                }
                
                // Add vendor equipment cost (only if vendor provides equipment)
                if (costProviders.equipment === 'vendor') {
                    totalDueToVendor += totalHours * equipmentRate;
                }
                
                // Add vendor material costs (only if vendor provides materials)
                if (costProviders.stripper === 'vendor') {
                    totalDueToVendor += stripperCost;
                }
                if (costProviders.finish === 'vendor') {
                    totalDueToVendor += finishCost;
                }
                if (costProviders.pads === 'vendor') {
                    totalDueToVendor += padsCost + suppliesCost;
                }
                
                // Total costs (already include margins)
                const totalCostToCW = vendorLaborCost + equipmentCost + finalMaterialCosts.total;
                const finalClientPrice = totalCostToCW; // Already includes all markups
                const cwGrossProfit = finalClientPrice - (calculateBaseCosts(totalHours, finalVendorRate, timeMultiplier, equipmentRate, stripperCost, finishCost, padsCost, suppliesCost));
                const pricePerSqFt = finalClientPrice / squareFootage;
                
                // Update display
                document.getElementById('totalHours').textContent = totalHours.toFixed(1);
                document.getElementById('vendorLaborCost').textContent = formatCurrency(vendorLaborCost);
                document.getElementById('equipmentCost').textContent = formatCurrency(equipmentCost);
                document.getElementById('materialCost').textContent = formatCurrency(finalMaterialCosts.total);
                document.getElementById('totalDueVendor').textContent = formatCurrency(totalDueToVendor);
                document.getElementById('pricePerSqFt').textContent = formatCurrencyDetailed(pricePerSqFt);
                document.getElementById('bidPrice').textContent = formatCurrency(finalClientPrice);
                document.getElementById('cwProfit').textContent = formatCurrency(cwGrossProfit);
                
                // Show results
                document.getElementById('resultsSection').style.display = 'block';
                document.getElementById('breakdownSection').style.display = 'block';
                
                // Generate breakdown
                generateDetailedBreakdown({
                    squareFootage: squareFootage,
                    serviceType: serviceType,
                    addBurnishing: addBurnishing,
                    primaryTaskHours: primaryTaskHours.toFixed(1),
                    finishHours: finishHours.toFixed(1),
                    prepHours: prepHours.toFixed(1),
                    burnishingHours: burnishingHours.toFixed(1),
                    primaryTaskName: primaryTaskName,
                    stripperGallons: stripperGallons,
                    finishGallons: finishGallons,
                    stripperCost: stripperCost,
                    finishCost: finishCost,
                    padsCost: padsCost,
                    suppliesCost: suppliesCost,
                    baseMaterialCost: stripperCost + finishCost + padsCost + suppliesCost,
                    materialCostWithMargin: finalMaterialCosts.total,
                    vendorLaborCost: vendorLaborCost,
                    equipmentCost: equipmentCost,
                    totalCostToCW: totalCostToCW,
                    finalClientPrice: finalClientPrice,
                    cwGrossProfit: cwGrossProfit,
                    timeMultiplier: timeMultiplier,
                    cwMargin: cwMargin,
                    rawLaborRate: parseFloat(document.getElementById('rawLaborRate').value) || 18,
                    vendorLoadedRate: finalVendorRate,
                    crewSize: crewSize,
                    furnitureDescription: furnitureDescription,
                    stripperCasePrice: parseFloat(document.getElementById('stripperCasePrice').value) || 90,
                    finishCasePrice: parseFloat(document.getElementById('finishCasePrice').value) || 140,
                    coats: coats,
                    costProviders: costProviders
                });
                
            } catch (error) {
                console.error('Error in calculatePricing:', error);
            }
        }
        
        function generateDetailedBreakdown(data) {
            try {
                const furnitureDesc = data.furnitureDescription || "Standard conditions";
                const rawRate = data.rawLaborRate || 18;
                const vendorRate = data.vendorLoadedRate || 22.03;
                const serviceTypeText = data.serviceType === 'strip_refinish' ? 'Strip & Refinish' : 'Scrub & Top Coat';
                const burnishingText = data.addBurnishing ? ' + Burnishing' : '';
                const fullServiceText = serviceTypeText + burnishingText;
                
                const breakdownHtml = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #DC2626;">
                            <h4 style="color: #DC2626; margin-bottom: 15px;">Labor Cost Structure</h4>
                            <p><strong>Raw Labor Rate:</strong> ${formatCurrencyDetailed(rawRate)}/hr</p>
                            <p><strong>IC Loaded Rate:</strong> ${formatCurrencyDetailed(vendorRate)}/hr</p>
                            <p><strong>Total Hours:</strong> ${(parseFloat(data.primaryTaskHours) + parseFloat(data.finishHours) + parseFloat(data.prepHours) + parseFloat(data.burnishingHours || 0)).toFixed(1)} hrs</p>
                            <p><strong>Vendor Labor Cost:</strong> ${formatCurrency(data.vendorLaborCost)}</p>
                            <p><strong>Equipment Cost:</strong> ${formatCurrency(data.equipmentCost)}</p>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #3B82F6;">
                            <h4 style="color: #3B82F6; margin-bottom: 15px;">Material Cost Structure</h4>
                            <p><strong>Base Material Cost:</strong> ${formatCurrency(data.baseMaterialCost)}</p>
                            <p><strong>Stripper Case Price:</strong> ${formatCurrency(data.stripperCasePrice)}/case (2 gal)</p>
                            <p><strong>Finish Case Price:</strong> ${formatCurrency(data.finishCasePrice)}/case (5 gal)</p>
                            <p><strong>Material Cost w/ Margin:</strong> ${formatCurrency(data.materialCostWithMargin)}</p>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #1E3A8A;">
                            <h4 style="color: #1E3A8A; margin-bottom: 15px;">City Wide Pricing</h4>
                            <p><strong>Total Cost to CW:</strong> ${formatCurrency(data.totalCostToCW)}</p>
                            <p><strong>CW Margin:</strong> ${data.cwMargin}% (applies to all costs)</p>
                            <p><strong>Final Client Price:</strong> ${formatCurrency(data.finalClientPrice)}</p>
                            <p><strong>CW Gross Profit:</strong> ${formatCurrency(data.cwGrossProfit)}</p>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #059669;">
                            <h4 style="color: #059669; margin-bottom: 15px;">Service & Task Breakdown</h4>
                            <p><strong>Service Type:</strong> ${fullServiceText}</p>
                            <p><strong>${data.primaryTaskName}:</strong> ${data.primaryTaskHours} hours</p>
                            <p><strong>Finishing:</strong> ${data.finishHours} hours (${data.coats} coats)</p>
                            <p><strong>Prep Work:</strong> ${data.prepHours} hours</p>
                            ${data.addBurnishing ? `<p><strong>Burnishing:</strong> ${data.burnishingHours} hours</p>` : ''}
                            <p><strong>Furniture:</strong> ${furnitureDesc}</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('detailedBreakdown').innerHTML = breakdownHtml;
                
                const materialHtml = `
                    <div class="material-item">
                        <h4>Provider Structure</h4>
                        <p><strong>Labor:</strong> ${data.costProviders.labor === 'vendor' ? 'Vendor (+10% IC profit)' : 'In-House (No IC profit)'}</p>
                        <p><strong>Equipment:</strong> ${data.costProviders.equipment === 'vendor' ? 'Vendor (+10% IC profit)' : 'In-House (No IC profit)'}</p>
                        <p><strong>Materials:</strong> ${data.costProviders.stripper === 'vendor' ? 'Vendor provided' : 'In-House provided'}</p>
                    </div>
                    <div class="material-item">
                        <h4>IC Rate Analysis</h4>
                        <p>Raw Rate: ${formatCurrencyDetailed(rawRate)}/hr</p>
                        <p>Load Factor: ${data.costProviders.labor === 'vendor' ? ((vendorRate / rawRate - 1) * 100).toFixed(0) + '%' : 'In-House Rate'}</p>
                        <p>Final Rate: ${formatCurrencyDetailed(vendorRate)}/hr</p>
                    </div>
                    <div class="material-item">
                        <h4>SC Johnson Stripper ${data.stripperGallons > 0 ? '' : '(Not Used)'}</h4>
                        <p>Provider: ${data.costProviders.stripper === 'vendor' ? 'Vendor (+10%)' : 'City Wide Direct'}</p>
                        <p>Case Price: ${formatCurrency(data.stripperCasePrice)} (2 gal)</p>
                        <p>Per Gallon: ${formatCurrency(data.stripperCasePrice / 2)}</p>
                        <p>Needed: ${data.stripperGallons} gallons</p>
                    </div>
                    <div class="material-item">
                        <h4>SC Johnson Floor Finish ${data.finishGallons > 0 ? '' : '(Not Used)'}</h4>
                        <p>Provider: ${data.costProviders.finish === 'vendor' ? 'Vendor (+10%)' : 'City Wide Direct'}</p>
                        <p>Case Price: ${formatCurrency(data.finishCasePrice)} (5 gal)</p>
                        <p>Per Gallon: ${formatCurrency(data.finishCasePrice / 5)}</p>
                        <p>Needed: ${data.finishGallons} gallons</p>
                    </div>
                `;
                
                document.getElementById('materialCalc').innerHTML = materialHtml;
                
            } catch (error) {
                console.error('Error in generateDetailedBreakdown:', error);
            }
        }
        
        function generateVendorPDF() {
            const squareFootage = parseFloat(document.getElementById('squareFootage').value) || 0;
            const serviceType = document.getElementById('serviceType').value;
            const addBurnishing = document.getElementById('addBurnishing').checked;
            const condition = document.getElementById('condition').value;
            const density = document.getElementById('density').value;
            const coats = parseInt(document.getElementById('coats').value) || 0;
            const floorType = document.getElementById('floorType').value;
            const crewSize = parseInt(document.getElementById('crewSize').value);
            const timeOfService = document.getElementById('timeOfService').value;
            
            if (squareFootage <= 0) {
                alert('Please enter project details before generating vendor specifications.');
                return;
            }
            
            // Get current calculations
            const totalHours = parseFloat(document.getElementById('totalHours').textContent) || 0;
            const materialCosts = getMaterialCosts();
            const stripperGallons = serviceType === 'strip_refinish' ? Math.ceil(squareFootage / materialCoverage.stripper) : 0;
            const finishGallons = Math.ceil((squareFootage * coats) / materialCoverage.finish);
            const padsNeeded = Math.ceil(squareFootage / 2000);
            
            const serviceTypeText = serviceType === 'strip_refinish' ? 'Full Strip & Refinish' : 'Scrub & Top Coat';
            const burnishingText = addBurnishing ? ' + High-Gloss Burnishing' : '';
            const conditionText = condition.charAt(0).toUpperCase() + condition.slice(1).replace('_', ' ');
            const densityText = density.charAt(0).toUpperCase() + density.slice(1).replace('_', ' ');
            const floorTypeText = floorType.toUpperCase();
            const timeText = timeOfService === 'third_shift' ? 'Third Shift (Midnight-6am)' : 'Normal Business Hours';
            
            const vendorContent = `
VENDOR PROJECT SPECIFICATIONS
Generated: ${new Date().toLocaleDateString()}

PROJECT OVERVIEW
================
Service Type: ${serviceTypeText}${burnishingText}
Total Square Footage: ${squareFootage.toLocaleString()} sq ft
Floor Type: ${floorTypeText}
Current Condition: ${conditionText}
Furniture Density: ${densityText}
Number of Finish Coats: ${coats}
Work Schedule: ${timeText}

LABOR REQUIREMENTS
==================
Estimated Total Hours: ${totalHours.toFixed(1)} hours
Recommended Crew Size: ${crewSize} person(s)
${crewSize > 1 ? `Team Completion Time: ${(totalHours).toFixed(1)} hours with ${crewSize} workers` : 'Single Worker Time: ' + totalHours.toFixed(1) + ' hours'}

MATERIAL REQUIREMENTS
=====================
${stripperGallons > 0 ? `Floor Stripper: ${stripperGallons} gallons (concentrate)
- Dilution ratio: 1:8 to 1:24 depending on buildup
- Coverage: ~600 sq ft per gallon when diluted` : ''}

Floor Finish: ${finishGallons} gallons (ready-to-use)
- Coverage: 3,000 sq ft per gallon per coat
- ${coats} coats required for this project

Stripping Pads: ${padsNeeded} pads minimum
- 20" black stripping pads recommended
- Additional pads for heavy buildup areas

Miscellaneous Supplies:
- Tack cloths for dust removal
- Mop heads (18" microfiber recommended)
- Warning cones and caution tape
- Drop cloths for furniture protection

EQUIPMENT NEEDED
================
Primary Equipment:
- 175 RPM floor machine (20" minimum)
- Wet vacuum for stripper removal
- Auto scrubber (if available, increases efficiency)
${addBurnishing ? '- 1500+ RPM burnisher for final high-gloss finish' : ''}

Secondary Equipment:
- Extension cords (GFCI protected)
- Mop bucket and wringer
- Squeegees for tight areas
- Edge cleaning tools

PROJECT SPECIFICATIONS
======================
${serviceType === 'strip_refinish' ? `Strip Process:
- Complete removal of existing finish
- Neutralize with clean water rinses
- Allow proper drying time between steps` : `Scrub Process:
- Deep clean existing finish surface
- Remove buildup without finish removal
- Prepare surface for new topcoats`}

Finish Application:
- Apply ${coats} even coats with proper dry time
- Maintain consistent mil thickness
- Ensure proper cross-linking between coats
${addBurnishing ? '\nBurnishing:\n- High-speed burnish after final coat cure\n- Achieve glass-like finish appearance' : ''}

ENVIRONMENTAL REQUIREMENTS
===========================
Temperature: 65-75 degrees F (optimal curing conditions)
Humidity: 30-50% relative humidity
Ventilation: Adequate air circulation required
Lighting: Proper lighting for quality control

QUALITY STANDARDS
=================
- No streaking or bubbling in finish
- Uniform gloss level throughout
- Complete adhesion to substrate
- No footprints or contamination
- Clean, sharp edges at perimeters

This specification provides estimated requirements based on industry standards and project parameters. Actual quantities may vary based on specific site conditions and contractor methods.
            `;
            
            downloadTextAsPDF(vendorContent, `Vendor_Specifications_${squareFootage}sqft_${new Date().toISOString().split('T')[0]}.pdf`);
        }
        
        function generateClientPDF() {
            const squareFootage = parseFloat(document.getElementById('squareFootage').value) || 0;
            const serviceType = document.getElementById('serviceType').value;
            const addBurnishing = document.getElementById('addBurnishing').checked;
            const coats = parseInt(document.getElementById('coats').value) || 0;
            const floorType = document.getElementById('floorType').value;
            
            if (squareFootage <= 0) {
                alert('Please enter project details before generating client instructions.');
                return;
            }
            
            const serviceTypeText = serviceType === 'strip_refinish' ? 'Strip & Refinish Service' : 'Scrub & Recoat Service';
            const burnishingText = addBurnishing ? ' with High-Gloss Burnishing' : '';
            const floorTypeText = floorType.toUpperCase();
            
            const clientContent = `
FLOOR CARE SERVICE INSTRUCTIONS
Generated: ${new Date().toLocaleDateString()}

SERVICE OVERVIEW
================
Service Scheduled: ${serviceTypeText}${burnishingText}
Area: ${squareFootage.toLocaleString()} square feet
Floor Type: ${floorTypeText}
Finish Coats: ${coats} coats of premium floor finish

PRE-SERVICE PREPARATION
=======================
REQUIRED - 24 Hours Before Service:
- Remove ALL furniture and equipment from the area
- Ensure room temperature is between 65-75 degrees F
- Provide access to electrical outlets
- Clear pathways for equipment movement
- Secure or remove any hanging items that could fall

CRITICAL - Day of Service:
- Maintain temperature between 65-75 degrees F throughout service
- Keep relative humidity between 30-50% if possible
- Ensure adequate ventilation (HVAC system operational)
- Restrict access to work areas during service
- Have building contact person available

DURING SERVICE PROCESS
======================
What to Expect:
${serviceType === 'strip_refinish' ? `- Complete removal of old floor finish
- Deep cleaning and preparation of floor surface
- Application of ${coats} new coats of premium finish` : `- Deep scrubbing to remove surface buildup
- Thorough cleaning and preparation
- Application of ${coats} fresh topcoats`}
${addBurnishing ? '- Final high-speed burnishing for glass-like finish' : ''}

Service Duration:
- Work will be completed in phases
- Each finish coat requires proper curing time
- Total project time depends on floor condition and size

CURING AND ACCESS RESTRICTIONS
===============================
CRITICAL TIMING INFORMATION:

Light Foot Traffic:
- Wait MINIMUM 2 hours after final coat
- Wear soft-soled shoes only
- No furniture replacement yet

Normal Foot Traffic:
- Wait MINIMUM 24 hours after final coat
- Regular shoes permitted
- Still no furniture or equipment

Furniture Replacement:
- Wait MINIMUM 72 hours (3 full days)
- Use furniture pads under all legs
- Drag nothing across the floor

FULL CURE COMPLETE:
- 7-10 days for maximum durability
- Heavy equipment can be moved after full cure

ENVIRONMENTAL REQUIREMENTS
===========================
MAINTAIN THESE CONDITIONS FOR 72 HOURS:
- Temperature: 65-75 degrees F (CRITICAL)
- No direct sunlight on floor during curing
- Minimal humidity fluctuations
- Avoid opening/closing exterior doors frequently
- No wet mopping for first 72 hours

POST-SERVICE CARE INSTRUCTIONS
===============================
First Week:
â€¢ Dust mop or vacuum only (no wet cleaning)
â€¢ Report any issues immediately
â€¢ No furniture pads removal or adjustments

Ongoing Maintenance:
â€¢ Use only pH-neutral floor cleaners
â€¢ Damp mop (not wet mop) for routine cleaning
â€¢ Place mats at all entrances
â€¢ Address spills immediately
â€¢ Use furniture pads permanently

QUALITY GUARANTEE
=================
Your new floor finish is backed by our quality guarantee:
â€¢ Uniform appearance and gloss level
â€¢ Proper adhesion and durability
â€¢ Professional workmanship standards
â€¢ Responsive service for any concerns

WARRANTY INFORMATION
====================
â€¢ Material defects covered per manufacturer warranty
â€¢ Workmanship guaranteed for specified period
â€¢ Proper maintenance required for warranty validity
â€¢ Document any concerns within 48 hours

IMPORTANT CONTACT INFORMATION
=============================
Service Issues: Contact immediately if you notice:
â€¢ Bubbling or peeling finish
â€¢ Uneven gloss or appearance
â€¢ Strong odors persisting beyond 24 hours
â€¢ Any safety concerns

Emergency Contact: [Your company emergency number]
Business Hours: [Your business hours]
Email: [Your company email]

FINAL REMINDERS
===============
- Temperature control is CRITICAL for proper curing
- Wait full 72 hours before furniture replacement
- Use furniture pads permanently
- Follow maintenance guidelines for longevity
- Contact us immediately with any concerns

Thank you for choosing City Wide Facility Solutions for your floor care needs. Following these instructions ensures optimal results and maximum durability of your investment.
            `;
            
            downloadTextAsPDF(clientContent, `Client_Instructions_${squareFootage}sqft_${new Date().toISOString().split('T')[0]}.pdf`);
        }
        
        function downloadTextAsPDF(content, filename) {
            // Convert to RTF format for better Word compatibility
            const rtfContent = convertToRTF(content);
            const blob = new Blob([rtfContent], { type: 'application/rtf;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename.replace('.pdf', '.rtf'); // Download as .rtf
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }
        
        function convertToRTF(text) {
            // RTF header
            let rtf = '{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Times New Roman;}}';
            
            // Split text into lines and format
            const lines = text.split('\n');
            
            for (let line of lines) {
                if (line.trim() === '') {
                    rtf += '\\par ';
                } else if (line.includes('=====')) {
                    // Skip separator lines
                    rtf += '\\par ';
                } else if (line.match(/^[A-Z\s]+$/) && line.length > 5 && !line.includes(':')) {
                    // Main headers (all caps, no colons)
                    rtf += '\\par \\b\\fs28 ' + escapeRTF(line.trim()) + '\\b0\\fs24\\par ';
                } else if (line.includes(':') && !line.startsWith(' ') && !line.startsWith('â€¢') && !line.startsWith('â–¡') && !line.startsWith('âœ“')) {
                    // Subheaders (contains colon, not indented)
                    rtf += '\\par \\b\\fs26 ' + escapeRTF(line.trim()) + '\\b0\\fs24\\par ';
                } else if (line.startsWith('â–¡') || line.startsWith('âœ“')) {
                    // Checkboxes
                    rtf += '\\par ' + escapeRTF(line.trim()) + '\\par ';
                } else if (line.startsWith('â€¢') || line.startsWith('-')) {
                    // Bullet points
                    rtf += '\\par \\bullet ' + escapeRTF(line.trim().substring(1)) + '\\par ';
                } else {
                    // Regular text
                    rtf += '\\par ' + escapeRTF(line.trim()) + '\\par ';
                }
            }
            
            rtf += '}';
            return rtf;
        }
        
        function escapeRTF(text) {
            // Escape special RTF characters
            return text.replace(/\\/g, '\\\\')
                      .replace(/\{/g, '\\{')
                      .replace(/\}/g, '\\}')
                      .replace(/\n/g, '\\par ');
        }
        
        // Initialize on page load
        window.onload = function() {
            try {
                updateICBreakdown();
                updateServiceType();
                calculatePricing();
            } catch (error) {
                console.error('Error on page load:', error);
            }
        };
    </script>
</body>
</html>
